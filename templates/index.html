<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CPU Scheduling Simulator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>

  <style>
    /* ===== Reset & Base ===== */
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
    }

    body {
      margin: 0;
      background: #f4f6fb;
      color: #1f2937;
    }

    h2, h4 {
      margin-top: 0;
      color: #111827;
    }

    /* ===== Container ===== */
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 30px;
    }

    /* ===== Layout ===== */
    .grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 24px;
      align-items: start;
    }

    .card {
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    /* ===== Form ===== */
    label {
      font-weight: 600;
      display: block;
      margin-top: 14px;
      margin-bottom: 6px;
    }

    textarea {
      width: 100%;
      height: 130px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-family: monospace;
    }

    select,
    input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: white;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.95;
    }

    /* ===== Table ===== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      border-radius: 10px;
      overflow: hidden;
    }

    thead {
      background: #4f46e5;
      color: white;
    }

    th, td {
      padding: 8px 10px;
      text-align: center;
      border-bottom: 1px solid #e5e7eb;
    }

    tbody tr:hover {
      background: #f3f4f6;
    }

    /* ===== Chart ===== */
    #chart {
      width: 100%;
      min-height: 360px;
    }

    .small {
      font-size: 0.9rem;
      color: #6b7280;
    }

    .averages {
      margin-top: 10px;
      font-weight: 600;
      text-align: right;
    }

    /* ===== Responsive ===== */
    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>CPU Scheduling Simulator</h2>
    <p class="subtitle">Flask + Plotly | Visualize CPU Scheduling Algorithms</p>

    <div class="grid">
      <!-- LEFT: INPUT & METRICS -->
      <div class="card">
        <form method="post" action="{{ url_for('simulate') }}">
          <label>Processes (one per line)</label>
          <textarea name="processes">{{ example }}</textarea>

          <label>Algorithm</label>
          <select name="algorithm">
            <option value="fcfs" {% if chosen_algorithm=='fcfs' %}selected{% endif %}>FCFS</option>
            <option value="sjf-np" {% if chosen_algorithm=='sjf-np' %}selected{% endif %}>SJF (Non-Preemptive)</option>
            <option value="sjf-p" {% if chosen_algorithm=='sjf-p' %}selected{% endif %}>SJF (Preemptive)</option>
            <option value="rr" {% if chosen_algorithm=='rr' %}selected{% endif %}>Round Robin</option>
            <option value="priority-np" {% if chosen_algorithm=='priority-np' %}selected{% endif %}>Priority (Non-Preemptive)</option>
            <option value="priority-p" {% if chosen_algorithm=='priority-p' %}selected{% endif %}>Priority (Preemptive)</option>
          </select>

          <label>Time Quantum (Round Robin)</label>
          <input type="number" name="quantum" value="{{ quantum if quantum is defined else 2 }}" min="1">

          <button type="submit">Simulate</button>
        </form>

        {% if rows is defined %}
          <h4 style="margin-top:30px;">Metrics</h4>
          <table>
            <thead>
              <tr>
                <th>PID</th><th>Arrival</th><th>Burst</th>
                <th>Start</th><th>Completion</th>
                <th>TAT</th><th>WT</th><th>RT</th>
              </tr>
            </thead>
            <tbody>
              {% for r in rows %}
              <tr>
                <td>{{ r.pid }}</td>
                <td>{{ r.arrival }}</td>
                <td>{{ r.burst }}</td>
                <td>{{ r.start if r.start is not none else '-' }}</td>
                <td>{{ r.completion if r.completion is not none else '-' }}</td>
                <td>{{ r.TAT if r.TAT is not none else '-' }}</td>
                <td>{{ r.WT if r.WT is not none else '-' }}</td>
                <td>{{ r.RT if r.RT is not none else '-' }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>

          <div class="averages">
            Avg TAT: {{ avgs.avg_tat|round(2) if avgs.avg_tat is not none else '-' }} |
            Avg WT: {{ avgs.avg_wt|round(2) if avgs.avg_wt is not none else '-' }} |
            Avg RT: {{ avgs.avg_rt|round(2) if avgs.avg_rt is not none else '-' }}
          </div>
        {% endif %}
      </div>

      <!-- RIGHT: GANTT -->
      <div class="card">
        <h4>Gantt Chart</h4>
        <div id="chart"></div>
        <p class="small">Hover bars for details. Zoom and pan supported.</p>
      </div>
    </div>
  </div>

  <script>
    var gantt_json = {{ gantt_json|safe if gantt_json is defined else 'null' }};

    function drawGantt(gantt) {
      var traces = [];
      for (var i = 0; i < gantt.length; i++) {
        var seg = gantt[i];
        traces.push({
          x: [seg.end - seg.start],
          y: [seg.pid],
          base: seg.start,
          type: 'bar',
          orientation: 'h',
          hovertemplate:
            seg.pid + "<br>Start: " + seg.start + "<br>End: " + seg.end + "<extra></extra>",
          showlegend: false
        });
      }

      Plotly.newPlot("chart", traces, {
        barmode: "stack",
        xaxis: { title: "Time" },
        margin: { l: 80, r: 20, t: 20, b: 40 },
        height: 100 + gantt.length * 25
      }, { responsive: true });
    }

    if (gantt_json) {
      drawGantt(gantt_json);
    } else {
      document.getElementById("chart").innerHTML =
        "<p class='small'>Run a simulation to see the Gantt chart.</p>";
    }
  </script>
</body>
</html>
